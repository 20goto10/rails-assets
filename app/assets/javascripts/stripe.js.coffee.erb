app = angular.module('app')

app.controller 'DonationCtrl', ['$scope', '$window', ($scope, $window) ->
  #closeOnBack = (event) ->
#    handler.close()#
#    event.stopPropagation()
#    event.preventDefault()

  handler = StripeCheckout.configure(
    key: '<%= Rails.configuration.stripe[:publishable_key] %>'
    image: '/img/documentation/checkout/marketplace.png'
    locale: 'auto'
    token: (token) ->
      debugger
    #opened: ->
  #    $window.addEventListener('popstate', closeOnBack)
#      history.pushState({}, 'close-stripe')#
    #closed: ->
  #    $window.removeEventListener('popstate', closeOnBack)
  )

  $scope.invoke = ->
    handler.open(
      name: 'Tenex Developers'
      description: 'Donation?'
      amount: 2000
    )
]
